<%- include("../partials/header.ejs") %>
<title>Meal Creator - Results</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Athiti:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
<%- include("../partials/navbar.ejs") %>
<!-------------------------------------------------- ENTER CONTENT HERE -------------------------------------------------->
<style>
body {
    font-family: 'Athiti', sans-serif;
}
.matched-meal-txt {
    font-family: 'Athiti', sans-serif;
    font-weight: 400;
}
.no-meals-message {
    font-family: 'Athiti', sans-serif;
    font-weight: 400;
    font-size: 2rem;
    text-align: center;
    color: #333;
    margin-top: 4rem;
    padding: 2rem;
}
/* Responsive meal results grid */
.matched-meal-row {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    width: 100% !important;
}
.matched-meal-row > div {
    flex: 0 0 100% !important;
    max-width: 100% !important;
    width: 100% !important;
    margin: 10px 0 !important;
    padding: 0 10px !important;
}
.matched-meal-row > div .selection-button-meal {
    width: 100% !important;
    max-width: 100% !important;
    max-height: none !important;
}
.matched-meal-row > div .selection-images {
    width: 100% !important;
    max-width: 100% !important;
    max-height: 400px !important;
    height: auto !important;
}
@media (min-width: 768px) {
    .matched-meal-row > div {
        flex: 0 0 calc(50% - 20px) !important;
        max-width: calc(50% - 20px) !important;
        margin: 10px !important;
        padding: 0 !important;
    }
}
@media (min-width: 1000px) {
    .matched-meal-row > div {
        flex: 0 0 calc(33.333% - 20px) !important;
        max-width: calc(33.333% - 20px) !important;
    }
}
@media (min-width: 1400px) {
    .matched-meal-row > div {
        flex: 0 0 calc(25% - 20px) !important;
        max-width: calc(25% - 20px) !important;
    }
}
</style>
<section class="container fourth-page-cont">
    <% if (matchedMeals.length === 0) { %>
        <div class="no-meals-message">
            No meals found. It looks like it's time for a shop!
        </div>
    <% } else { %>
        <div style="display: flex !important; flex-wrap: wrap !important; justify-content: flex-start !important; width: 100% !important; padding: 0 !important; margin: 0 !important;">
        <% let res = []; for (meal of matchedMeals) { %> 
            <% 
            // Optimize Cloudinary image URL for faster loading
            let optimizedImgSrc = meal.imgSrc || 'https://res.cloudinary.com/meal-creator/image/upload/v1662460322/meal-images/untitled-meal.jpg';
            if (optimizedImgSrc && optimizedImgSrc.includes('cloudinary.com') && !optimizedImgSrc.includes('/w_')) {
                optimizedImgSrc = optimizedImgSrc.replace('/upload/', '/upload/w_400,h_400,c_fill,q_auto,f_auto/');
            }
            %>
            <div style="flex: 0 0 100% !important; max-width: 100% !important; width: 100% !important; margin: 10px 0 !important; padding: 0 10px !important; display: flex !important; justify-content: center !important; box-sizing: border-box !important;">
                <button class="btn btn-default selection-button-meal p-1" id = "matched-meal-btn" style="width: 100% !important; max-width: 100% !important; max-height: none !important;">
                    <img src="<%=optimizedImgSrc%>" class="selection-images img-fluid" alt="<%=meal.mealName%>" style="opacity: 1 !important; visibility: visible !important; width: 100% !important; max-width: 100% !important; max-height: 400px !important; height: auto !important;" onerror="this.src='https://res.cloudinary.com/meal-creator/image/upload/v1662460322/meal-images/untitled-meal.jpg'"> 
                    <div class="matched-meal-txt"><%=meal.mealName%></div>
                </button>
            </div> 
        <% } %>
        </div>
    <% } %>
</section>
<!--------------------------------------------------- CONTENT ENDS HERE -------------------------------------------------->
<%- include("../partials/scripts.ejs") %>
<script src="/js/filtered-page.js"></script>
<%- include("../partials/footer.ejs") %>